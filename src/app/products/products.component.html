@if(isLoading){
  <div class="flex justify-center items-center h-64">
    <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-16 w-16"></div>
  </div>
}
@else{
<app-generic-table
  [items]="items"
  [headerTemplate]="productHeader"
  [rowTemplate]="productRow"
  (edit)="edit($event)"
  (delete)="delete($event)"
  (create)="creating = true"
>
</app-generic-table>

<ng-template #productHeader>
  <tr>
    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nom</th>
    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix</th>
    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
    <th scope="col" class="relative px-6 py-3"><span class="sr-only">Actions</span></th>
  </tr>
</ng-template>


<ng-template #productRow let-p let-edit="edit" let-delete="delete">
  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ p.nom }}</td>
  <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">{{ p.description ?? 'N/A' }}</td>
  <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-bold">{{ p.prix }} £</td>
  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ p.stock }}</td>

  <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
    <div class="flex justify-end gap-2">
      <button (click)="edit.emit(p)" class="text-green-500">
        <lucide-angular [img]="PenIcon" class="w-4 h-4"></lucide-angular>
      </button>
      <button (click)="delete.emit(p.id)" class="text-red-500">
        <lucide-angular [img]="TrashIcon" class="w-4 h-4"></lucide-angular>
      </button>
    </div>
  </td>
</ng-template>


@if(editing || creating){
<div class="mx-auto max-w-lg bg-white p-6 rounded-2xl shadow mb-10">
  <h3 class="text-xl font-semibold mb-4 text-center">
    {{ editing ? "Modifier un produit" : "Ajouter un produit" }}
  </h3>

  <form (ngSubmit)="save()" class="space-y-4">

    <input type="text" placeholder="Nom du produit"
      [(ngModel)]="form.nom" name="nom"
      class="w-full border rounded-lg p-3" required />

    <textarea placeholder="Description"
      [(ngModel)]="form.description" name="description" required
      class="w-full border rounded-lg p-3"></textarea>

    <input type="number" placeholder="Prix"
      [(ngModel)]="form.prix" name="prix"
      class="w-full border rounded-lg p-3" required />

    <input type="number" placeholder="Stock"
      [(ngModel)]="form.stock" name="stock"
      class="w-full border rounded-lg p-3" required />

    <select placeholder="Catégorie"
      [(ngModel)]="form.categorieId" name="categorie"
      class="w-full border rounded-lg p-3" required >
      <option value="" disabled selected>Choisir une catégorie</option>
      @for(cat of categories; track cat.id){
        <option  [value]="cat.id">{{ cat.nom }}</option>
      }

    </select>


    <div class="flex justify-between">
      <button type="submit"
        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
        {{ editing ? "Mettre à jour" : "Ajouter" }}
      </button>


      <button type="button"
        (click)="cancelEdit()"
        class="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition">
        Annuler
      </button>


    </div>

  </form>
</div>
}
}
